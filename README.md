# VoiceTask

## 📱 プロジェクト概要
**VoiceTask**は、音声入力で簡単にスケジュールを管理できる、あらゆるデバイス（スマホ・タブレット・PC）に対応したレスポンシブWebアプリケーションです。

### 🎯 主な特徴
- **音声入力対応**: 「明日10時 重要 顧客に電話 30分」と話すだけで自動的にタスクを作成
- **日本語自然言語解析**: chrono-nodeを使用した高精度な日時解析
- **レスポンシブデザイン**: iPhone、iPad、Android、デスクトップすべてで快適に動作
- **タッチ最適化**: 最小44x44pxのタップターゲット、スワイプジェスチャー対応
- **通知機能**: 重要なタスクは開始10分前にブラウザ通知
- **PWA対応**: ホーム画面に追加してアプリのように使用可能

## 🌐 公開URL

### サンドボックス環境（開発用）
- **URL**: https://3000-iaucei33hu14f8a45otlh-3844e1b6.sandbox.novita.ai
- **用途**: 開発・テスト環境
- **有効期限**: セッション終了まで

### Cloudflare Pages（本番環境）
- **デプロイ方法**: `npm run deploy:prod`
- **プロジェクト名**: voicetask
- **本番URL**: デプロイ後に表示されます

## 🛠️ 技術スタック

### フロントエンド
- **React 19**: UIフレームワーク
- **TypeScript**: 型安全性
- **TailwindCSS**: ユーティリティファーストCSS（CDN版）
- **date-fns**: 日付操作ライブラリ
- **chrono-node**: 自然言語日時解析
- **uuid**: 一意ID生成

### バックエンド
- **Hono**: 軽量高速Webフレームワーク
- **Cloudflare Pages**: エッジデプロイプラットフォーム
- **Wrangler**: Cloudflare開発ツール

### ビルド・開発ツール
- **Vite**: 高速ビルドツール
- **PM2**: プロセス管理（開発環境）

## 📦 データ構造

### Task型
```typescript
{
  id: string,           // UUID
  title: string,        // タスク名
  note: string,         // 元の音声テキスト
  dateISO: string,      // 開始日時（ISO 8601形式）
  durationMin: number,  // 所要時間（分）
  priority: "low" | "normal" | "high",
  done: boolean,        // 完了フラグ
  notify: boolean       // 通知フラグ
}
```

### ストレージ
- **LocalStorage**: ユーザーごとのタスクデータを保存
- **キー形式**: `voicetask_{email}`
- **通知スケジューラー**: タイマーベース（デモ用、本番ではService Worker推奨）

## 🚀 使い方

### 開発環境での起動
```bash
# 依存関係のインストール
npm install

# ビルド
npm run build

# 開発サーバー起動（PM2）
pm2 start ecosystem.config.cjs

# サービス確認
npm test
```

### ユーザー操作
1. **ログイン**: メールアドレスを入力（デモ用、認証なし）
2. **日付選択**: カレンダーストリップから予定を登録したい日付をタップ
3. **タスク追加**: ボイスメモエリアで音声入力または手入力
4. **確認して登録**: 選択した日付を確認して「この日付に追加」をタップ
5. **タスク管理**: チェックボックスで完了、展開して詳細表示・削除
6. **通知設定**: 重要タスクは自動で通知ON、手動でも切替可能

### 音声入力の例（日付は選択済み）
- 「10時 重要 顧客に見積提出 30分」
- 「午後3時 会議 1時間」
- 「至急 書類提出」
- 「14時 プレゼン準備 2時間」

## 🎨 レスポンシブ対応

### スマートフォン（〜768px）
- 縦1カラムレイアウト
- サイドバーはモーダル表示
- タッチ最適化UI（最小44x44px）
- スワイプジェスチャーでカレンダー操作

### タブレット（768px〜1024px）
- 縦1カラムレイアウト（スマホと同様）
- より大きなタップターゲット

### デスクトップ（1024px〜）
- 2カラムレイアウト（メイン + サイドバー）
- サイドバー常時表示
- ホバーエフェクト

### Safe Area対応
- iPhone X以降のノッチ・ホームインジケーターに対応
- `env(safe-area-inset-*)` を使用した余白調整

## 📝 実装済み機能

✅ メールベースのログイン（デモ用）  
✅ 音声認識（Web Speech API、日本語対応）  
✅ 自然言語日時解析（chrono-node）  
✅ タスクのCRUD操作  
✅ 完了/未完了切替  
✅ 通知ON/OFF切替  
✅ カレンダービュー（7日間表示）  
✅ スワイプジェスチャー  
✅ レスポンシブデザイン  
✅ ブラウザ通知（10分前）  
✅ LocalStorageによるデータ永続化  
✅ アコーディオンUI（展開/折りたたみ）  
✅ iCalendar形式エクスポート（.ics）  
✅ iPhone対応音声録音ボタン（完全再設計）  
✅ カレンダー日付とタスクの同期表示  
✅ **カレンダー選択ベースのタスク作成フロー** 🆕  

## 📅 カレンダーアプリとの連携

VoiceTaskの予定を他のカレンダーアプリにエクスポートできます。

### エクスポート方法

1. **全予定のエクスポート**
   - ヘッダーの「📅 エクスポート」ボタンをクリック
   - `voicetask-YYYYMMDD.ics`ファイルがダウンロードされます

2. **個別予定のエクスポート**
   - タスクを展開
   - 「📅 この予定をカレンダーにエクスポート」ボタンをクリック

### 対応カレンダーアプリ

#### 📱 **Google Calendar**
1. [Google Calendar](https://calendar.google.com/)を開く
2. 左側メニューの「設定」→「インポート/エクスポート」
3. 「カレンダーをインポート」を選択
4. ダウンロードした`.ics`ファイルを選択
5. インポート先のカレンダーを選択して「インポート」

#### 🍎 **Apple Calendar（iPhone/iPad/Mac）**
1. ダウンロードした`.ics`ファイルをタップ/ダブルクリック
2. 自動的にカレンダーアプリが開きます
3. 「追加」または「すべて追加」を選択
4. カレンダーを選択して完了

#### 📧 **Outlook（Microsoft 365）**
1. Outlookを開く
2. 「ファイル」→「開く/エクスポート」→「インポート/エクスポート」
3. 「iCalendarまたはvCalendarファイルをインポート」を選択
4. `.ics`ファイルを選択
5. カレンダーを選択して「OK」

#### 🌐 **Yahoo!カレンダー**
1. Yahoo!カレンダーを開く
2. 右上の「設定」→「カレンダー」
3. 「カレンダーをインポート」を選択
4. `.ics`ファイルをアップロード

### iCalendar形式の内容

エクスポートされる`.ics`ファイルには以下の情報が含まれます：

- ✅ タスク名（SUMMARY）
- ✅ 開始日時（DTSTART）
- ✅ 終了日時（DTEND、所要時間に基づく）
- ✅ メモ（DESCRIPTION）
- ✅ 優先度（PRIORITY: 重要=1, 通常=5, 低=9）
- ✅ ステータス（STATUS: 完了/確認済み）
- ✅ アラーム（VALARM: 通知ONの場合、10分前）
- ✅ 一意ID（UID）

### 注意事項

- エクスポートは一方向のみ（VoiceTask → 他カレンダー）
- カレンダーアプリでの変更はVoiceTaskに反映されません
- 定期的に再エクスポートして最新の状態を同期してください

## 🔜 未実装機能（今後の拡張）

⏳ Firebase Authによる本格的な認証  
⏳ Firestore/Supabaseによるクラウド同期  
⏳ Service Workerによるオフライン対応  
⏳ プッシュ通知（バックグラウンド通知）  
⏳ タスクの編集機能  
⏳ カテゴリ・タグ機能  
⏳ 定期タスク（リピート）  
⏳ カレンダーの双方向同期（Google Calendar API連携）  
⏳ 音声合成による読み上げ  
⏳ ダークモード  

## 🔧 推奨される次のステップ

1. **認証の実装**: Firebase Auth または Supabase Auth に切り替え
2. **データベース移行**: LocalStorage → Firestore/Supabase に移行
3. **Service Worker追加**: オフライン対応とプッシュ通知
4. **タスク編集機能**: 既存タスクの修正・更新
5. **カテゴリ分類**: プロジェクトやタグでタスクを整理
6. **共有機能**: チームでスケジュールを共有
7. **統計ダッシュボード**: 完了率、作業時間の可視化

## 📄 デプロイステータス

- **プラットフォーム**: Cloudflare Pages
- **ステータス**: 🟡 デプロイ準備完了（Cloudflare API Key設定後にデプロイ可能）
- **技術スタック**: Hono + React + TypeScript + TailwindCSS
- **最終更新**: 2025年10月29日

### 最新の変更

- **カレンダー選択ベースのタスク作成フロー**（2025-10-29）
  - 新しいUX: カレンダーで日付を選択 → 内容を入力 → 登録
  - 音声入力から日付解析を排除し、より直感的な操作に
  - 選択中の日付を視覚的に表示（グラデーションボックス）
  - 時刻のみ音声認識で自動抽出（例：「10時」「午後3時」）
  - ユーザーが日付を完全にコントロール可能
  - 自然言語日付解析のエラーを削減

- **カレンダー日付とタスクの同期表示**（2025-10-29）
  - カレンダーストリップに各日付のタスク数を表示（例：「予定 3」）
  - ボイスメモで登録した内容がリアルタイムでカレンダーに反映
  - タスクがない日付は「予定」のみ表示
  - 今日の日付は常に「今日」と表示
  - 週全体のタスク分布を一目で把握可能に

- **iPhone音声録音ボタンの完全再設計**（2025-10-29）
  - `<button>`要素から`<div>`要素に変更してiOSのタッチイベント問題を回避
  - 複雑なイベントハンドラー（onTouchStart/onTouchEnd）を削除し、シンプルなonClickに統一
  - マイクロフォンアイコンを絵文字からSVGに変更して視覚的品質を向上
  - ボタンサイズを80x80pxに拡大してタップしやすさを改善
  - iOS特有の最適化を追加：
    * `WebkitTapHighlightColor` でタップハイライトを無効化
    * `touchAction: 'manipulation'` でダブルタップズームを防止
    * `userSelect: 'none'` でテキスト選択を防止
  - より魅力的なグラデーション、影、アニメーション効果を実装

## 📞 サポート

問題や質問がある場合は、GitHubのIssuesで報告してください。

---

© 2025 VoiceTask - All devices supported 🌍📱💻
